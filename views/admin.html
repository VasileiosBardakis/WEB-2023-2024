<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Saviors Inc. - Admin</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" type="text/css" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <style>
    </style>
  </head>

  <body>
      <nav class="navbar navbar-default nav-background">
          <div class="container-fluid">
              <div class="navbar-header">
                  <a class="navbar-brand" href="/admin">
                      <!--
                        <img
                      src=""
                      alt="My logo"
                      class="headerLogo"
                    />
                     -->
                      <div style="font-size: 3rem">Saviors Inc.</div>
                  </a>
              </div>
          </div>
      </nav>

      <div class="admin">
          <h1>Admin Hub</h1>




          <button id="adRes" type="button" onclick="addRescuer()">Add a rescuer account</button>
          <button id="shStats" type="button" onclick="shStats()">Service Statistics</button>
          <button id="shStore" type="button" onclick="shStore()">Storage</button>
          <button id="mkAn" type="button" onclick="mkAn()">Make an announcement</button>
          <br>
          <div id="error-message"></div>  <!--Error message is displayed here -->
          <div id="storage">
            <!--Storage is displayed here -->
          </div>
          <div id="inputFieldsDiv">
              <!-- Input fields will be inserted here -->
          </div>
          <form action="/logout?_method=DELETE" method="post">
              <button type="submit">Logout</button>
          </form>

          </div>







 
      <script>
          var adResClick = false; //Variable to see if 'add a rescuer' is clicked
          var mkAnClick = false; //Variable to see if 'make announcement' is clicked
          var shStoreClick = false; //Variable to see if 'Storage' is clicked

          var xhr = new XMLHttpRequest();
          xhr.onreadystatechange = function() {
          if (xhr.readyState == 4 && xhr.status == 200) {
            var jsonResponse = JSON.parse(xhr.responseText);
            displayData(jsonResponse);
            }
          };

          function clearFields() {
              document.getElementById('inputFieldsDiv').innerHTML = '';
              document.getElementById('error-message').innerHTML = '';
              adResClick = false;
              mkAnClick = false;
              shStoreClick = false;
          }
          function addRescuer() {
              if (!adResClick) {       //If addRescuer isn't clicked, show input fields
                  adResClick = true;
                  //Html code for input fields
                  var inputFieldsHTML = `
                                        <div class="form-outline mb-4">
                                        <input type="text" id="username" class="form-control" />
                                        <label class="form-label" for="username">Username</label>
                                        </div>
                                         <div class="form-outline mb-4">
                                        <input type="password" id="password" class="form-control" />
                                        <label class="form-label" for="password">Password</label>
                                        </div>
                                        <div class="form-outline mb-4">
                                        <input type="text" id="name" class="form-control" />
                                        <label class="form-label" for="name">Full name</label>
                                        </div>
                                        <div class="form-outline mb-4">
                                        <input type="text" id="telephone" class="form-control" />
                                        <label class="form-label" for="telephone">Telephone</label>
                                        </div>
                                        <button type="button" onclick="register()" class="btn btn-primary btn-block mb-4">Submit</button>
                                                              `;
                  //insert the HTML content into the designated div
                  document.getElementById('inputFieldsDiv').innerHTML = inputFieldsHTML;
              }
              else {    //clear if addRescuer fields are showing
                  clearFields();
              }
          }



          function register() {
              var username = document.getElementById('username').value;
              var password = document.getElementById('password').value;
              var type = 2;
              var name = document.getElementById('name').value;
              var telephone = document.getElementById('telephone').value;
              var errorMessageElement = document.getElementById('error-message');

              var xhttp = new XMLHttpRequest();
              xhttp.open('POST', '/register', true);
              xhttp.setRequestHeader('Content-Type', 'application/json');

              xhttp.onreadystatechange = function () {
                  if (xhttp.readyState === 4) {
                      if (xhttp.status === 401) {
                          // Handle incorrect username/password with AJAX
                          var response = JSON.parse(xhttp.responseText);
                          errorMessageElement.innerHTML = response.error;
                      } else if (xhttp.status === 200) {
                          errorMessageElement.innerHTML = 'Rescuer account successfully registered';
                      }
                  }
              };

              var data = JSON.stringify({ username: username, password: password, type: type, name: name, telephone: telephone });
              xhttp.send(data);
          }

          function shStats() {
            clearFields()
            
          }

          function shStore() {
              if (!shStoreClick) {       //If Storage isn't clicked, show input fields
                  shStoreClick = true;
                  console.log("Fetching data...");
                  var xhrs = new XMLHttpRequest();
                  xhrs.onreadystatechange = function() {
                    console.log("Ready state:", xhrs.readyState);
                    if (xhrs.readyState == 4 && xhrs.status == 200) {
                        console.log("Response received:", xhr.status, xhr.responseText);
                        var jsonResponse = JSON.parse(xhrs.responseText);
                        console.log("JSON response:", jsonResponse);
                        displayData(jsonResponse);
                    }
                };
                xhrs.open("GET", "http://localhost:3000/api/items", true);
                console.log("Before sending AJAX request");
                xhrs.send();
                console.log("After sending AJAX request");
          }else {    //clear if storage table is showing
                clearFields();
              }
          }

          function displayData(data) {
            console.log("Displaying data:", data);
            var storageDiv = document.getElementById("storage");
            console.log("Storage div retrieved:", storageDiv);
            for (var i = 0; i < data.items.length; i++) {
                var item = data.items[i];
                storageDiv.innerHTML += "ID: " + item.id + ", Name: " + item.name + ", Category: " + item.category;
            }
            console.log("Content inside storageDiv:", storageDiv.innerHTML);
          }
   
          
          function mkAn() {

              if (!mkAnClick) {       //If addRescuer isn't clicked, show input fields
                  mkAnClick = true;

                  //Html code for input fields
                  var inputFieldsHTML = `
                          <div class="form-outline mb-4">
                          <input type="text" id="title" class="form-control" />
                          <label class="form-label" for="title">Title</label>
                          </div>
                           <div class="form-outline mb-4">
                          <input type="text" id="anText" class="form-control" />
                          <label class="form-label" for="anText">Announcement text</label>
                          </div>
                           <label for="dropdown">Select a Fruit:</label>
                            <select id="dropdown">
                            </select>
                          <button type="button" onclick="announceDatabase()" class="btn btn-primary btn-block mb-4">Submit</button>
                                                `;
                  //insert the HTML content into the designated div
                  document.getElementById('inputFieldsDiv').innerHTML = inputFieldsHTML;
                  var xhr = new XMLHttpRequest();
                  xhr.open('GET', '/api/items', true);
                  xhr.onreadystatechange = function () {
                      if (xhr.readyState === 4 && xhr.status === 200) {
                          var data = JSON.parse(xhr.responseText);

                          // Populate the dropdown with items
                          data.items.forEach(function (item) {
                              var option = document.createElement('option');
                              option.value = item.id;
                              option.text = item.name;
                              dropdown.appendChild(option);
                          });
                      }
                  };
                  xhr.send();
              }
              else {    //clear if mkAn fields are showing
                  clearFields();
              }

          }

          function announceDatabase() {
              console.log("announce");
          }
      </script>


      <script src="js/admin.js"></script>
      <noscript>Sorry, your browser does not support JavaScript!</noscript>







  </body>
</html>